<template>
    <div class="sandbox-container">
      <!-- 主要内容区域 -->
      <main class="main-content">
        <div class="file-info-container">
          <div class="file-icon-container">
            <div class="file-icon">
              <img :src="MalwareLogo" width="124" height="124" class="malware-icon" />
            </div>
            <div class="malware-label">{{ fileInfo.threatLevel }}</div>
          </div>
  
          <div class="file-details">
            <h1 class="file-name">{{ fileInfo.fileName }}</h1>
  
            <div class="file-metadata">
              <div class="metadata-row">
                <div class="metadata-item">
                  <div class="metadata-label">首次提交：</div>
                  <div class="metadata-value">{{ fileInfo.firstSubmit }}</div>
                </div>
                <div class="metadata-item">
                  <div class="metadata-label">末次提交：</div>
                  <div class="metadata-value">{{ fileInfo.lastSubmit }}</div>
                </div>
                <div class="metadata-item">
                  <div class="metadata-label">末次分析：</div>
                  <div class="metadata-value">{{ fileInfo.lastAnalysis }}</div>
                </div>
              </div>
  
              <div class="metadata-row">
                <div class="metadata-item">
                  <div class="metadata-label">文件大小：</div>
                  <div class="metadata-value">{{ fileInfo.fileSize }}</div>
                </div>
                <div class="metadata-item">
                  <div class="metadata-label">文件类型：</div>
                  <div class="metadata-value">{{ fileInfo.fileType }}</div>
                </div>
              </div>
  
              <div class="metadata-row">
                <div class="metadata-item">
                  <div class="metadata-label">引擎检出：</div>
                  <div class="metadata-value">
                    <span class="detection-ratio">{{ fileInfo.detectionCount }} / {{ fileInfo.engineCount }}</span>
                  </div>
                </div>
                <div class="metadata-item">
                  <div class="metadata-label">分析环境：</div>
                  <div class="metadata-value">
                    <span class="environment-tag">
                      <WindowsIcon size="14" />
                      {{ fileInfo.environment }}
                    </span>
                  </div>
                </div>
              </div>
  
              <div class="metadata-row">
                <div class="metadata-item">
                  <div class="metadata-label">威胁分类：</div>
                  <div class="metadata-value">
                    <div class="tooltip-container">
                      <span class="threat-tag">{{ fileInfo.threatType }}</span>
                      <HelpCircleIcon size="14" class="help-icon" />
                      <div class="tooltip">{{ fileInfo.threatTypeDesc }}</div>
                    </div>
                  </div>
                </div>
                <div class="metadata-item">
                  <div class="metadata-label">木马家族：</div>
                  <div class="metadata-value">
                    <span class="family-tag">
                      <ShieldAlertIcon size="14" />
                      {{ fileInfo.malwareFamily }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
  
            <div class="hash-section">
              <div class="hash-row">
                <div class="hash-label">SHA256:</div>
                <div class="hash-value">{{ fileInfo.sha256 }}</div>
              </div>
              <div class="hash-row">
                <div class="hash-label">MD5:</div>
                <div class="hash-value">{{ fileInfo.md5 }}</div>
              </div>
              <div class="hash-row">
                <div class="hash-label">SHA1:</div>
                <div class="hash-value">{{ fileInfo.sha1 }}</div>
              </div>
            </div>
  
            <div class="action-buttons">
              <button class="action-btn" 
                @mouseenter="showDownloadHover = true"
                @mouseleave="showDownloadHover = false"
                :class="{ 'hover': showDownloadHover }"
              >
                <DownloadIcon size="16" />
                样本下载
              </button>
              <div class="dropdown-container" 
                @mouseenter="showDerivativeDropdown = true"
                @mouseleave="showDerivativeDropdown = false"
              >
                <button class="action-btn dropdown" :class="{ 'hover': showDerivativeDropdown }">
                  <FileTextIcon size="16" />
                  衍生文件
                  <ChevronDownIcon size="16" :class="{ 'rotate-180': showDerivativeDropdown }" />
                </button>
                <div class="dropdown-menu" v-show="showDerivativeDropdown">
                  <button class="dropdown-item">
                    <FileIcon size="16" />
                    PCAP
                  </button>
                  <button class="dropdown-item">
                    <FileIcon size="16" />
                    内存dump
                  </button>
                </div>
              </div>
              <div class="dropdown-container"
                @mouseenter="showReportDropdown = true"
                @mouseleave="showReportDropdown = false"
              >
                <button class="action-btn dropdown" :class="{ 'hover': showReportDropdown }">
                  <FileTextIcon size="16" />
                  报告下载
                  <ChevronDownIcon size="16" :class="{ 'rotate-180': showReportDropdown }" />
                </button>
                <div class="dropdown-menu" v-show="showReportDropdown">
                  <button class="dropdown-item">
                    <FileIcon size="16" />
                    PDF
                  </button>
                  <button class="dropdown-item">
                    <FileIcon size="16" />
                    JSON
                  </button>
                </div>
              </div>
              <button class="action-btn"
                @mouseenter="showAnalyzeHover = true"
                @mouseleave="showAnalyzeHover = false"
                :class="{ 'hover': showAnalyzeHover }"
              >
                <RefreshCwIcon size="16" />
                重新分析
              </button>
            </div>
          </div>
        </div>
  
        <!-- 分析结果标签页 -->
        <div class="analysis-tabs">
          <div class="sidebar">
            <div 
              v-for="(tab, index) in tabs" 
              :key="index" 
              class="sidebar-item" 
              :class="{ active: activeTab === index }"
              @click="activeTab = index"
            >
              <component :is="tab.icon" size="18" />
              <span>{{ tab.name }}</span>
            </div>
          </div>
  
          <div class="tab-content">
            <!-- 情报IOC 标签页内容 -->
            <div v-if="activeTab === 0" class="ioc-section">
              <div class="section-header">
                <h3>情报IOC</h3>
                <HelpCircleIcon size="16" class="help-icon" />
              </div>
  
              <div class="ioc-table">
                <table>
                  <thead>
                    <tr>
                      <th>情报IOC</th>
                      <th>IOC类型</th>
                      <th>判定</th>
                      <th>情报内容</th>
                      <th>发现IOC环境</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="(ioc, index) in iocData" :key="index">
                      <td>{{ ioc.value }}</td>
                      <td>{{ ioc.type }}</td>
                      <td class="danger-text">{{ ioc.verdict }}</td>
                      <td>
                        <span 
                          v-for="(tag, tagIndex) in ioc.tags" 
                          :key="tagIndex" 
                          :class="tag.type === 'danger' ? 'danger-tag' : 'family-tag'"
                        >
                          <component v-if="tag.icon" :is="tag.icon" size="14" />
                          {{ tag.text }}
                        </span>
                      </td>
                      <td>
                        <span class="environment-tag">
                          <WindowsIcon size="14" />
                          {{ ioc.environment }}
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
  
            <!-- 行为检测标签页内容 -->
            <div v-if="activeTab === 1" class="detection-section">
              <!-- 高危行为 -->
              <div class="behavior-section" v-if="maliciousBehaviors.length > 0">
                <div class="section-header">
                  <div class="header-title">
                    <AlertOctagonIcon size="20" class="icon-danger" />
                    <h3>高危行为 ({{ maliciousBehaviors.length }})</h3>
                  </div>
                </div>
                <div class="behavior-list">
                  <div v-for="behavior in maliciousBehaviors" :key="behavior.name" class="behavior-item danger">
                    <div class="behavior-header" @click="toggleBehavior(behavior.name)">
                      <div class="behavior-title">
                        <span class="behavior-name">{{ JSON.parse(behavior.description).cn }}</span>
                        <span class="behavior-tag">{{ behavior.sigClassStr }}</span>
                        <span v-if="behavior.attck_id" class="attck-tag">
                          <ShieldAlertIcon size="14" />
                          {{ behavior.attck_id }}
                        </span>
                      </div>
                      <ChevronDownIcon 
                        size="20" 
                        :class="{ 'rotate-180': expandedBehaviors.includes(behavior.name) }" 
                      />
                    </div>
                    <div v-show="expandedBehaviors.includes(behavior.name)" class="behavior-details">
                      <div v-if="behavior.attck_info && Object.keys(behavior.attck_info).length > 0" class="attck-info">
                        <div class="attck-header">ATT&CK信息</div>
                        <div class="attck-content">
                          <div v-for="(value, key) in behavior.attck_info" :key="key" class="attck-item">
                            <span class="attck-label">{{ key }}:</span>
                            <span class="attck-value">{{ value }}</span>
                          </div>
                        </div>
                      </div>
                      <div class="marks-container">
                        <div v-for="(mark, index) in behavior.marks" :key="index" class="mark-item">
                          <template v-if="mark.type === 'ioc'">
                            <div class="mark-header">IOC信息</div>
                            <div class="mark-content">
                              <div class="mark-field">
                                <span class="field-label">类型:</span>
                                <span class="field-value">{{ mark.ioc.category }}</span>
                              </div>
                              <div class="mark-field">
                                <span class="field-label">值:</span>
                                <span class="field-value">{{ mark.ioc.ioc }}</span>
                              </div>
                              <div v-if="mark.ioc.pid && mark.ioc.pid.length > 0" class="mark-field">
                                <span class="field-label">进程ID:</span>
                                <span class="field-value">{{ mark.ioc.pid.join(', ') }}</span>
                              </div>
                            </div>
                          </template>
                          <template v-else-if="mark.type === 'call'">
                            <div class="mark-header">API调用</div>
                            <div class="mark-content">
                              <div class="mark-field">
                                <span class="field-label">API:</span>
                                <span class="field-value">{{ mark.call.api }}</span>
                              </div>
                              <div class="mark-field">
                                <span class="field-label">进程ID:</span>
                                <span class="field-value">{{ mark.pid }}</span>
                              </div>
                              <div class="mark-field">
                                <span class="field-label">参数:</span>
                                <span class="field-value">{{ JSON.stringify(mark.call.arguments) }}</span>
                              </div>
                            </div>
                          </template>
                          <template v-else-if="mark.type === 'generic'">
                            <div class="mark-header">通用信息</div>
                            <div class="mark-content">
                              <div v-if="mark.generic.file" class="mark-field">
                                <span class="field-label">文件名:</span>
                                <span class="field-value">{{ mark.generic.file.name }}</span>
                              </div>
                              <div v-if="mark.generic.parent_process" class="mark-field">
                                <span class="field-label">父进程:</span>
                                <span class="field-value">{{ mark.generic.parent_process }}</span>
                              </div>
                              <div v-if="mark.generic.martian_process" class="mark-field">
                                <span class="field-label">可疑进程:</span>
                                <span class="field-value">{{ mark.generic.martian_process }}</span>
                              </div>
                            </div>
                          </template>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
  
              <!-- 可疑行为 -->
              <div class="behavior-section" v-if="suspiciousBehaviors.length > 0">
                <div class="section-header">
                  <div class="header-title">
                    <AlertCircleIcon size="20" class="icon-warning" />
                    <h3>可疑行为 ({{ suspiciousBehaviors.length }})</h3>
                  </div>
                </div>
                <div class="behavior-list">
                  <div v-for="behavior in suspiciousBehaviors" :key="behavior.name" class="behavior-item warning">
                    <!-- 与高危行为相同的内部结构 -->
                    <div class="behavior-header" @click="toggleBehavior(behavior.name)">
                      <div class="behavior-title">
                        <span class="behavior-name">{{ JSON.parse(behavior.description).cn }}</span>
                        <span class="behavior-tag">{{ behavior.sigClassStr }}</span>
                        <span v-if="behavior.attck_id" class="attck-tag">
                          <ShieldAlertIcon size="14" />
                          {{ behavior.attck_id }}
                        </span>
                      </div>
                      <ChevronDownIcon 
                        size="20" 
                        :class="{ 'rotate-180': expandedBehaviors.includes(behavior.name) }" 
                      />
                    </div>
                    <!-- 展开的详细信息部分与高危行为相同 -->
                    <div v-show="expandedBehaviors.includes(behavior.name)" class="behavior-details">
                      <!-- 与高危行为相同的详情结构 -->
                      <div v-if="behavior.attck_info && Object.keys(behavior.attck_info).length > 0" class="attck-info">
                        <div class="attck-header">ATT&CK信息</div>
                        <div class="attck-content">
                          <div v-for="(value, key) in behavior.attck_info" :key="key" class="attck-item">
                            <span class="attck-label">{{ key }}:</span>
                            <span class="attck-value">{{ value }}</span>
                          </div>
                        </div>
                      </div>
                      <div class="marks-container">
                        <!-- 与高危行为相同的marks结构 -->
                        <div v-for="(mark, index) in behavior.marks" :key="index" class="mark-item">
                          <template v-if="mark.type === 'ioc'">
                            <div class="mark-header">IOC信息</div>
                            <div class="mark-content">
                              <div class="mark-field">
                                <span class="field-label">类型:</span>
                                <span class="field-value">{{ mark.ioc.category }}</span>
                              </div>
                              <div class="mark-field">
                                <span class="field-label">值:</span>
                                <span class="field-value">{{ mark.ioc.ioc }}</span>
                              </div>
                              <div v-if="mark.ioc.pid && mark.ioc.pid.length > 0" class="mark-field">
                                <span class="field-label">进程ID:</span>
                                <span class="field-value">{{ mark.ioc.pid.join(', ') }}</span>
                              </div>
                            </div>
                          </template>
                          <template v-else-if="mark.type === 'call'">
                            <div class="mark-header">API调用</div>
                            <div class="mark-content">
                              <div class="mark-field">
                                <span class="field-label">API:</span>
                                <span class="field-value">{{ mark.call.api }}</span>
                              </div>
                              <div class="mark-field">
                                <span class="field-label">进程ID:</span>
                                <span class="field-value">{{ mark.pid }}</span>
                              </div>
                              <div class="mark-field">
                                <span class="field-label">参数:</span>
                                <span class="field-value">{{ JSON.stringify(mark.call.arguments) }}</span>
                              </div>
                            </div>
                          </template>
                          <template v-else-if="mark.type === 'generic'">
                            <div class="mark-header">通用信息</div>
                            <div class="mark-content">
                              <div v-if="mark.generic.file" class="mark-field">
                                <span class="field-label">文件名:</span>
                                <span class="field-value">{{ mark.generic.file.name }}</span>
                              </div>
                              <div v-if="mark.generic.parent_process" class="mark-field">
                                <span class="field-label">父进程:</span>
                                <span class="field-value">{{ mark.generic.parent_process }}</span>
                              </div>
                              <div v-if="mark.generic.martian_process" class="mark-field">
                                <span class="field-label">可疑进程:</span>
                                <span class="field-value">{{ mark.generic.martian_process }}</span>
                              </div>
                            </div>
                          </template>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
  
              <!-- 一般行为 -->
              <div class="behavior-section" v-if="generalBehaviors.length > 0">
                <div class="section-header">
                  <div class="header-title">
                    <InfoIcon size="20" class="icon-info" />
                    <h3>一般行为 ({{ generalBehaviors.length }})</h3>
                  </div>
                </div>
                <div class="behavior-list">
                  <div v-for="behavior in generalBehaviors" :key="behavior.name" class="behavior-item info">
                    <!-- 与高危行为相同的内部结构 -->
                    <div class="behavior-header" @click="toggleBehavior(behavior.name)">
                      <div class="behavior-title">
                        <span class="behavior-name">{{ JSON.parse(behavior.description).cn }}</span>
                        <span class="behavior-tag">{{ behavior.sigClassStr }}</span>
                        <span v-if="behavior.attck_id" class="attck-tag">
                          <ShieldAlertIcon size="14" />
                          {{ behavior.attck_id }}
                        </span>
                      </div>
                      <ChevronDownIcon 
                        size="20" 
                        :class="{ 'rotate-180': expandedBehaviors.includes(behavior.name) }" 
                      />
                    </div>
                    <!-- 展开的详细信息部分与高危行为相同 -->
                    <div v-show="expandedBehaviors.includes(behavior.name)" class="behavior-details">
                      <!-- 与高危行为相同的详情结构 -->
                      <div v-if="behavior.attck_info && Object.keys(behavior.attck_info).length > 0" class="attck-info">
                        <div class="attck-header">ATT&CK信息</div>
                        <div class="attck-content">
                          <div v-for="(value, key) in behavior.attck_info" :key="key" class="attck-item">
                            <span class="attck-label">{{ key }}:</span>
                            <span class="attck-value">{{ value }}</span>
                          </div>
                        </div>
                      </div>
                      <div class="marks-container">
                        <!-- 与高危行为相同的marks结构 -->
                        <div v-for="(mark, index) in behavior.marks" :key="index" class="mark-item">
                          <template v-if="mark.type === 'ioc'">
                            <div class="mark-header">IOC信息</div>
                            <div class="mark-content">
                              <div class="mark-field">
                                <span class="field-label">类型:</span>
                                <span class="field-value">{{ mark.ioc.category }}</span>
                              </div>
                              <div class="mark-field">
                                <span class="field-label">值:</span>
                                <span class="field-value">{{ mark.ioc.ioc }}</span>
                              </div>
                              <div v-if="mark.ioc.pid && mark.ioc.pid.length > 0" class="mark-field">
                                <span class="field-label">进程ID:</span>
                                <span class="field-value">{{ mark.ioc.pid.join(', ') }}</span>
                              </div>
                            </div>
                          </template>
                          <template v-else-if="mark.type === 'call'">
                            <div class="mark-header">API调用</div>
                            <div class="mark-content">
                              <div class="mark-field">
                                <span class="field-label">API:</span>
                                <span class="field-value">{{ mark.call.api }}</span>
                              </div>
                              <div class="mark-field">
                                <span class="field-label">进程ID:</span>
                                <span class="field-value">{{ mark.pid }}</span>
                              </div>
                              <div class="mark-field">
                                <span class="field-label">参数:</span>
                                <span class="field-value">{{ JSON.stringify(mark.call.arguments) }}</span>
                              </div>
                            </div>
                          </template>
                          <template v-else-if="mark.type === 'generic'">
                            <div class="mark-header">通用信息</div>
                            <div class="mark-content">
                              <div v-if="mark.generic.file" class="mark-field">
                                <span class="field-label">文件名:</span>
                                <span class="field-value">{{ mark.generic.file.name }}</span>
                              </div>
                              <div v-if="mark.generic.parent_process" class="mark-field">
                                <span class="field-label">父进程:</span>
                                <span class="field-value">{{ mark.generic.parent_process }}</span>
                              </div>
                              <div v-if="mark.generic.martian_process" class="mark-field">
                                <span class="field-label">可疑进程:</span>
                                <span class="field-value">{{ mark.generic.martian_process }}</span>
                              </div>
                            </div>
                          </template>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
  
            <!-- 引擎检测 标签页内容 -->
            <div v-if="activeTab === 3" class="engine-detection">
              <div class="detection-header">
                <h3>多引擎检测</h3>
                <div class="detection-summary">
                  <span class="detection-ratio">检出率：{{ engineData.report_num }}/{{ engineData.total }}</span>
                  <span class="detection-time">最近检测时间：{{ engineData.recent_scan }}</span>
                </div>
              </div>
  
              <div class="engine-grid">
                <div v-for="(engine, index) in displayEngines" :key="index" class="engine-item">
                  <div class="engine-name">{{ engine.engine_desc }}</div>
                  <div class="engine-result" :class="{ 'is-malicious': engine.result !== 'safe' }">
                    <AlertCircleIcon v-if="engine.result !== 'safe'" size="14" class="alert-icon" />
                    {{ engine.result }}
                  </div>
                </div>
              </div>
  
              <div v-if="engineData.engine_result.length > 4" class="show-more" @click="showAllEngines = !showAllEngines">
                <span>{{ showAllEngines ? '收起' : '查看全部' }}</span>
                <ChevronDownIcon :class="{ 'rotate-180': showAllEngines }" size="16" />
              </div>
            </div>
  
            <!-- 静态分析 标签页内容 -->
            <div v-if="activeTab === 4" class="static-analysis">
              <!-- 基本信息 -->
              <div class="analysis-section">
                <div class="section-header-with-icon">
                  <FileIcon size="20" />
                  <h3 class="section-title">基本信息</h3>
                </div>
                <div class="info-grid">
                  <div v-for="(value, key) in staticData.baseInfo" :key="key" class="info-item">
                    <span class="info-label">{{ key }}：</span>
                    <span class="info-value">{{ value }}</span>
                    <div class="info-divider"></div>
                  </div>
                </div>
              </div>
  
              <!-- ExifTool信息 -->
              <div class="analysis-section">
                <div class="section-header-with-icon">
                  <FileIcon size="20" />
                  <h3 class="section-title">ExifTool信息</h3>
                </div>
                <div class="info-grid">
                  <div v-for="(value, key) in staticData.exifTool" :key="key" class="info-item">
                    <span class="info-label">{{ key }}：</span>
                    <span class="info-value">{{ value }}</span>
                    <div class="info-divider"></div>
                  </div>
                </div>
              </div>
              
              <!-- diec信息 -->
              <div class="analysis-section">
                <div class="section-header-with-icon">
                  <FileIcon size="20" />
                  <h3 class="section-title">DIE信息</h3>
                </div>
                <div class="info-grid">
                  <div v-for="(value, key) in staticData.diec" :key="key" class="info-item">
                    <span class="info-label">{{ key }}：</span>
                    <span class="info-value">{{ value }}</span>
                    <div class="info-divider"></div>
                  </div>
                </div>
              </div>

              <!-- magika信息 -->
              <div class="analysis-section">
                <div class="section-header-with-icon">
                  <FileIcon size="20" />
                  <h3 class="section-title">Magika信息</h3>
                </div>
                <div class="info-grid">
                  <div v-for="(value, key) in staticData.magika" :key="key" class="info-item">
                    <span class="info-label">{{ key }}：</span>
                    <span class="info-value">{{ value }}</span>
                    <div class="info-divider"></div>
                  </div>
                </div>
              </div>

              <!-- trid信息 -->
              <div class="analysis-section">
                <div class="section-header-with-icon">
                  <FileIcon size="20" />
                  <h3 class="section-title">Trid信息</h3>
                </div>
                <div class="info-grid">
                  <div v-for="(value, key) in staticData.trid" :key="key" class="info-item">
                    <span class="info-label">{{ key }}：</span>
                    <span class="info-value">{{ value }}</span>
                    <div class="info-divider"></div>
                  </div>
                </div>
              </div>
  
              <!-- PE头信息 -->
              <div class="analysis-section">
                <div class="section-header-with-icon">
                  <DatabaseIcon size="20" />
                  <h3 class="section-title">PE头信息</h3>
                </div>
                <div class="info-grid">
                  <div v-for="(value, key) in staticData.pe.headMap" :key="key" class="info-item">
                    <span class="info-label">{{ key }}：</span>
                    <span class="info-value">{{ value }}</span>
                    <div class="info-divider"></div>
                  </div>
                </div>
              </div>
  
              <!-- PE节区 -->
              <div class="analysis-section">
                <div class="section-header-with-icon">
                  <LayersIcon size="20" />
                  <h3 class="section-title">PE节区</h3>
                </div>
                <div class="sections-table-container">
                  <table class="sections-table">
                    <thead>
                      <tr>
                        <th>节区名</th>
                        <th>虚拟地址</th>
                        <th>虚拟大小</th>
                        <th>物理地址</th>
                        <th>物理大小</th>
                        <!-- <th>权限</th> -->
                        <th>熵值</th>
                        <th>节区哈希</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr v-for="section in staticData.pe.sectionsMap" :key="section.name">
                        <td>{{ section.name }}</td>
                        <td>{{ section.virtual_address }}</td>
                        <td>{{ section.virtual_size }}</td>
                        <td>{{ section.physical_address }}</td>
                        <td>{{ section.physical_size }}</td>
                        <!-- <td>{{ section.permissions }}</td> -->
                        <td>{{ section.entropy }}</td>
                        <td>{{ section.section_hash }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
  
              <!-- 导入表 -->
              <div class="analysis-section">
                <div class="section-header-with-icon">
                  <FolderTreeIcon size="20" />
                  <h3 class="section-title">导入表</h3>
                </div>
                <div class="imports-container">
                  <table class="imports-table">
                    <thead>
                      <tr>
                        <th>DLL名称</th>
                        <th>函数数量</th>
                        <th>操作</th>
                      </tr>
                    </thead>
                    <tbody>
                      <template v-for="imp in staticData.pe.importsMap" :key="imp.dll">
                        <tr>
                          <td>
                            <div class="dll-name">
                              <FileIcon size="16" />
                              <span>{{ imp.dll_name }}</span>
                            </div>
                          </td>
                          <td>{{ imp.function_count }}</td>
                          <td>
                            <button 
                              class="expand-btn" 
                              @click="toggleDllDetails(imp.dll_name)"
                              :class="{ 'expanded': expandedDlls.includes(imp.dll_name) }"
                            >
                              <ChevronDownIcon size="16" />
                            </button>
                          </td>
                        </tr>
                        <tr v-show="expandedDlls.includes(imp.dll_name)" class="details-row">
                          <td colspan="3" class="function-details">
                            <div class="function-list">
                              <div v-for="func in imp.functions" :key="func.address" class="function-item">
                                <span class="function-address">{{ func.address }}</span>
                                <span class="function-name">{{ func.name }}</span>
                              </div>
                            </div>
                          </td>
                        </tr>
                      </template>
                    </tbody>
                  </table>
                </div>
              </div>
  
              <!-- 字符串 -->
              <div class="analysis-section">
                <div class="section-header-with-icon">
                  <TextIcon size="20" />
                  <h3 class="section-title">字符串</h3>
                </div>
                <div class="strings-container">
                  <div class="strings-tabs">
                    <button 
                      :class="{ active: activeStringTab === 'ASCII' }" 
                      @click="activeStringTab = 'ASCII'"
                    >ASCII</button>
                    <button 
                      :class="{ active: activeStringTab === 'Unicode' }" 
                      @click="activeStringTab = 'Unicode'"
                    >Unicode</button>
                  </div>
                  <div class="strings-content">
                    <div v-for="str in staticData.pe.fileMap.strings[activeStringTab]" :key="str" class="string-item">
                      {{ str }}
                      <div class="string-divider"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
  
            <!-- 多维检测标签页内容 -->
            <div v-if="activeTab === 2" class="detection-section">
              <!-- Yara规则 -->
              <div class="section-header">
                <h3>Yara规则</h3>
              </div>
              <div class="yara-table-container">
                <table class="sigma-table">
                  <thead>
                    <tr>
                      <th>规则名称</th>
                      <th>描述</th>
                      <th>匹配项</th>
                      <th>源</th>
                      <th>分析环境</th>
                    </tr>
                  </thead>
                  <tbody>
                    <template v-for="rule in yaraRules.merged.tsmam" :key="rule.name">
                      <tr>
                        <td>{{ rule.name }}</td>
                        <td>{{ rule.description || '无描述' }}</td>
                        <td>
                          <button class="matches-btn" @click="toggleYaraMatches(rule.name)">
                            {{ rule.matches.length }} 条匹配
                            <ChevronDownIcon 
                              size="14" 
                              :class="{ 'rotate-180': expandedYaraMatches.includes(rule.name) }" 
                            />
                          </button>
                        </td>
                        <td>{{ rule.source }}</td>
                        <td>
                          <div class="environment-tags">
                            <span v-for="env in rule.sandboxType" :key="env" class="environment-tag">
                              <WindowsIcon size="14" />
                              {{ env }}
                            </span>
                          </div>
                        </td>
                      </tr>
                      <!-- 匹配项详情行 -->
                      <tr v-show="expandedYaraMatches.includes(rule.name)" class="matches-row">
                        <td colspan="5">
                          <div class="matches-details">
                            <div class="match-item">
                              <div class="match-header">匹配字符串</div>
                              <div class="match-content">
                                <div v-for="match in rule.matches" :key="match" class="match-field">
                                  <span class="field-value">{{ match }}</span>
                                </div>
                              </div>
                            </div>
                            <div class="match-item">
                              <div class="match-header">文件路径</div>
                              <div class="match-content">
                                <div class="match-field">
                                  <span class="field-value">{{ rule.path }}</span>
                                </div>
                              </div>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>
  
              <!-- Sigma规则 -->
              <div class="section-header">
                <h3>Sigma规则</h3>
              </div>
              <div class="sigma-table-container">
                <table class="sigma-table">
                  <thead>
                    <tr>
                      <th>标题</th>
                      <th>描述</th>
                      <th>标签</th>
                      <th>危险等级</th>
                      <th>匹配项</th>
                      <th>源</th>
                      <th>分析环境</th>
                    </tr>
                  </thead>
                  <tbody>
                    <template v-for="rule in sigmaRules.merged" :key="rule.title">
                      <tr>
                        <td>{{ rule.title }}</td>
                        <td>{{ rule.description }}</td>
                        <td>
                          <div class="tags-container">
                            <span v-for="tag in rule.tags" :key="tag" class="tag">
                              {{ tag }}
                            </span>
                          </div>
                        </td>
                        <td>
                          <span :class="['level-tag', rule.level]">{{ rule.level }}</span>
                        </td>
                        <td>
                          <button class="matches-btn" @click="toggleMatches(rule.title)">
                            {{ rule.matches.length }} 条匹配
                            <ChevronDownIcon 
                              size="14" 
                              :class="{ 'rotate-180': expandedMatches.includes(rule.title) }" 
                            />
                          </button>
                        </td>
                        <td>{{ rule.source }}</td>
                        <td>
                          <div class="environment-tags">
                            <span v-for="env in rule.sandboxType" :key="env" class="environment-tag">
                              <WindowsIcon size="14" />
                              {{ env }}
                            </span>
                          </div>
                        </td>
                      </tr>
                      <!-- 匹配项详情行 -->
                      <tr v-show="expandedMatches.includes(rule.title)" class="matches-row">
                        <td colspan="7">
                          <div class="matches-details">
                            <div v-for="match in rule.matches" :key="match.row_id" class="match-item">
                              <div class="match-header">事件 ID: {{ match.EventID }}</div>
                              <div class="match-content">
                                <div class="match-field">
                                  <span class="field-label">进程:</span>
                                  <span class="field-value">{{ match.Image }}</span>
                                </div>
                                <div class="match-field">
                                  <span class="field-label">命令行:</span>
                                  <span class="field-value">{{ match.CommandLine || match.TargetObject || '-' }}</span>
                                </div>
                                <div class="match-field">
                                  <span class="field-label">时间:</span>
                                  <span class="field-value">{{ match.UtcTime }}</span>
                                </div>
                              </div>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </template>
  
  <script setup>
  import { ref, computed, onMounted } from 'vue'
  import { useRoute } from 'vue-router'
  import { ElMessage } from 'element-plus'
  import { 
    AlertOctagon as AlertOctagonIcon,
    HelpCircle as HelpCircleIcon,
    ShieldAlert as ShieldAlertIcon,
    Download as DownloadIcon,
    FileText as FileTextIcon,
    RefreshCw as RefreshCwIcon,
    ChevronDown as ChevronDownIcon,
    Activity as ActivityIcon,
    Layers as LayersIcon,
    Link as LinkIcon,
    PauseCircle as PauseCircleIcon,
    PlayCircle as PlayCircleIcon,
    AlertCircle as AlertCircleIcon,
    Monitor as WindowsIcon,
    File as FileIcon,
    Database as DatabaseIcon,
    FolderTree as FolderTreeIcon,
    Text as TextIcon,
    Info as InfoIcon,
  } from 'lucide-vue-next'
  import MalwareLogo from '@/assets/malwarelogo.svg'
  import { useUserStore } from '@/stores/user'
  import { API_BASE_URL } from '@/config'

  const route = useRoute()
  const sha256 = route.params.sha256
  const userStore = useUserStore()
  
  // 模拟数据
  const fileInfo = ref({})
  
  // 获取样本基本信息
  const getFileInfo = async () => {
    try {
      const response = await fetch(`${API_BASE_URL}/api/v1/samples/${sha256}/baseinfo`, {
        headers: {
          'Authorization': `Bearer ${userStore.token}`
        }
      })
      if (!response.ok) {
        throw new Error('获取样本基本信息失败')
      }
      const result = await response.json()
      if(result.data) {
        fileInfo.value = result.data
      }
    } catch (error) {
      ElMessage.error('获取样本基本信息失败')
      console.error('获取样本基本信息失败:', error)
    }
  }
  
  onMounted(async () => {
    await getFileInfo()
    await GetYaraRules()
    await GetSigmaRules()
    await GetEngineData()
    await GetBehaviorDetection()
    await GetStaticData()
  })
  
  // 标签页数据
  const tabs = [
    { name: '情报IOC', icon: FileTextIcon },
    { name: '行为检测', icon: ActivityIcon },
    { name: '多维检测', icon: LayersIcon },
    { name: '引擎检测', icon: LinkIcon },
    { name: '静态分析', icon: PauseCircleIcon },
    { name: '动态分析', icon: PlayCircleIcon }
  ]
  
  const activeTab = ref(0)
  
  // IOC数据
  const iocData = [
    {
      value: 'boyonnem.ddns.net',
      type: 'Domain',
      verdict: '恶意',
      tags: [
        { text: '恶意软件', type: 'danger' },
        { text: '远控', type: 'danger' },
        { text: 'Cryptinject木马', type: 'danger', icon: FileTextIcon },
        { text: 'Noancode黑客工具', type: 'danger', icon: FileTextIcon }
      ],
      environment: 'Win10(1903 64bit,Office2016)'
    },
    {
      value: '13e69bf725e206a1129ddc5bd069f3298a0b0d3c92fe8fc5647c4471b1164bb2',
      type: 'Hash',
      verdict: '恶意',
      tags: [
        { text: 'AutoIt', type: 'family', icon: ShieldAlertIcon },
        { text: '木马', type: 'danger' }
      ],
      environment: 'Win10(1903 64bit,Office2016)'
    }
  ]
  
  // 高危行为数据
  const highRisks = [
    {
      title: '创建自启动项',
      description: '恶意程序通过修改注册表创建自启动项，实现系统重启后自动运行'
    },
    {
      title: '窃取用户凭证',
      description: '恶意程序尝试获取系统中存储的用户名和密码信息'
    },
    {
      title: '远程连接控制',
      description: '恶意程序建立与远程服务器的连接，可能用于数据窃取或远程控制'
    }
  ]
  
  // 行为检测
  const behaviorDetection = ref()
  const GetBehaviorDetection = async () => {
    try {
      const response = await fetch(`${API_BASE_URL}/api/v1/samples/${sha256}/behavior`, {
        headers: {
          'Authorization': `Bearer ${userStore.token}`
        }
      })
      if (!response.ok) {
        throw new Error('获取行为检测数据失败')
      }
      const result = await response.json()
      if (result.data) {
        behaviorDetection.value = result.data
      }
    } catch (error) {
      console.error('获取行为检测数据失败', error)
    }
  }
  // 多维检测数据
  // yara
  const yaraRules = ref()
  const GetYaraRules = async () => {
    try {
      const response = await fetch(`${API_BASE_URL}/api/v1/samples/${sha256}/yara`, {
        headers: {
          'Authorization': `Bearer ${userStore.token}`
      }
    })
    if (!response.ok) {
      throw new Error('获取Yara规则失败')
    }
    const result = await response.json()
    if (result.data) {
      yaraRules.value = result.data
    }
    } catch (error) {
      console.error('获取Yara规则失败', error)
    }
  }
  
  // sigma规则
  const sigmaRules = ref()

  const GetSigmaRules = async () => {
    try {
      const response = await fetch(`${API_BASE_URL}/api/v1/samples/${sha256}/sigma`, {
        headers: {
          'Authorization': `Bearer ${userStore.token}`
        }
      })
      if (!response.ok) {
        console.error('获取Sigma规则失败', response)
        throw new Error('获取Sigma规则失败')
      }
      const result = await response.json()
      if (result.data) {
        sigmaRules.value = result.data
      }
    } catch (error) {
      console.error('获取Sigma规则失败', error)
    }
  }
  
  // 静态分析数据
  const staticData = ref()
  const GetStaticData = async () => {
    try {
      const response = await fetch(`${API_BASE_URL}/api/v1/samples/${sha256}/static`, {
        headers: {
          'Authorization': `Bearer ${userStore.token}`
        }
      })
      if (!response.ok) {
        throw new Error('获取静态分析数据失败')
      }
      const result = await response.json()
      if (result.data) {
        console.log(result.data)
        staticData.value = result.data
      }
    } catch (error) {
      console.error('获取静态分析数据失败', error)
    }
  }
  // 动态分析数据
  
  // 引擎检测数据
  const engineData = ref()
  const GetEngineData = async () => {
    try {
      const response = await fetch(`${API_BASE_URL}/api/v1/samples/${sha256}/multi_engine_detection`, {
        headers: {
        'Authorization': `Bearer ${userStore.token}`
      }
    })
    if (!response.ok) {
      console.error('获取引擎检测数据失败', response)
      throw new Error('获取引擎检测数据失败')
    }
    const result = await response.json()
    if (result.data) {
        engineData.value = result.data
      }
    } catch (error) {
      console.error('获取引擎检测数据失败', error)
    }
  }
  const showAllEngines = ref(false)
  
  const displayEngines = computed(() => {
    return showAllEngines.value 
      ? engineData.value.engine_result 
      : engineData.value.engine_result.slice(0, 4)
  })
  
  // 静态分析相关状态
  const expandedDlls = ref([])
  
  const toggleDllDetails = (dllName) => {
    const index = expandedDlls.value.indexOf(dllName)
    if (index === -1) {
      expandedDlls.value.push(dllName)
    } else {
      expandedDlls.value.splice(index, 1)
    }
  }
  
  const activeStringTab = ref('ASCII')
  
  const showDerivativeDropdown = ref(false)
  const showReportDropdown = ref(false)
  const showDownloadHover = ref(false)
  const showAnalyzeHover = ref(false)
  
  const expandedMatches = ref([])
  
  const toggleMatches = (title) => {
    const index = expandedMatches.value.indexOf(title)
    if (index === -1) {
      expandedMatches.value.push(title)
    } else {
      expandedMatches.value.splice(index, 1)
    }
  }
  
  const expandedYaraMatches = ref([])
  
  const toggleYaraMatches = (name) => {
    const index = expandedYaraMatches.value.indexOf(name)
    if (index === -1) {
      expandedYaraMatches.value.push(name)
    } else {
      expandedYaraMatches.value.splice(index, 1)
    }
  }
  
  // 行为检测相关
  const expandedBehaviors = ref([])
  
  const toggleBehavior = (name) => {
    const index = expandedBehaviors.value.indexOf(name)
    if (index === -1) {
      expandedBehaviors.value.push(name)
    } else {
      expandedBehaviors.value.splice(index, 1)
    }
  }
  
  // 按危险等级分类行为
  const maliciousBehaviors = computed(() => {
    return behaviorDetection.value.filter(b => b.severityStr === 'malicious')
  })
  
  const suspiciousBehaviors = computed(() => {
    return behaviorDetection.value.filter(b => b.severityStr === 'suspicious')
  })
  
  const generalBehaviors = computed(() => {
    return behaviorDetection.value.filter(b => b.severityStr === 'general')
  })
  </script>
  
  <style scoped>
  .sandbox-container {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    color: #8f5f5f;
    background-color: #f5f5f5;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 100%;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    overflow-x: hidden;
  }
  
  /* 主要内容区域样式 */
  .main-content {
    flex: 1;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
  
  .file-info-container {
    display: flex;
    background-color: white;
    border-radius: 8px;
    padding: 2rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }
  
  .file-icon-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-right: 2rem;
    justify-content: center;  /* 垂直居中 */
    height: 100%;  /* 让容器占满父元素高度 */
  }
  
  .file-icon {
    width: 150px;
    height: 150px;
    background-color: white;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 0.5rem;
  }
  
  .malware-icon {
    color: #e53935;
  }
  
  .malware-label {
    color: #e53935;
    font-weight: bold;
  }
  
  .file-details {
    flex: 1;
  }
  
  .file-name {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 1.5rem;
    word-break: break-all;
  }
  
  .file-metadata {
    margin-bottom: 1.5rem;
  }
  
  .metadata-row {
    display: flex;
    margin-bottom: 1rem;
  }
  
  .metadata-item {
    display: flex;
    margin-right: 2rem;
    min-width: 250px;
  }
  
  .metadata-label {
    display: inline-block;
    color: #666;
    width: 80px;
  }
  
  .metadata-value {
    font-weight: 500;
  }

  .field-label {
  width: 80px;
  display: inline-block;
  text-align: left;
  }
  
  .detection-ratio {
    color: #e53935;
  }
  
  .environment-tag {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    background-color: #e3f2fd;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
  }
  
  .threat-tag {
    display: inline-flex;
    align-items: center;
    background-color: #ffebee;
    color: #e53935;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
    margin-right: 0.5rem;
  }
  
  .family-tag {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    background-color: #fff8e1;
    color: #ff8f00;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
  }
  
  .help-icon {
    color: #999;
    cursor: pointer;
    margin-left: 0.25rem;
  }
  
  .hash-section {
    margin-bottom: 1.5rem;
    padding: 0 1rem;
  }
  
  .hash-section h3 {
    font-size: 1rem;
    margin-bottom: 0.5rem;
    color: #666;
  }
  
  .hash-row {
    display: flex;
    margin-bottom: 0.5rem;
  }
  
  .hash-label {
    display: flex;
    width: 80px;
    color: #cb5e5e;
  }
  
  .hash-value {
    font-family: monospace;
    word-break: break-all;
    font-size: 15px;
  }
  
  .action-buttons {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  
  .action-btn {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    background-color: #cdcdeb;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 0.5rem 0.75rem;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.3s ease;
  }
  
  .action-btn.hover {
    background-color: #e53935;
    border-color: #e53935;
    color: white;
  }
  
  .action-btn.hover svg {
    color: white;
  }
  
  .action-btn.dropdown {
    padding-right: 0.5rem;
  }
  
  /* 分析结果标签页样式 */
  .analysis-tabs {
    display: flex;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    flex: 1;
    min-height: 600px;
  }
  
  .sidebar {
    min-width: 200px;
    background-color: #f9f9f9;
    border-right: 1px solid #eee;
    padding: 1rem 0;
    flex-shrink: 0;
  }
  
  .sidebar-item, .environment-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    cursor: pointer;
    color: #666;
  }
  
  .sidebar-item:hover, .environment-item:hover {
    background-color: #f0f0f0;
  }
  
  .sidebar-item.active {
    background-color: #e3f2fd;
    color: #1976d2;
    border-left: 3px solid #1976d2;
  }
  
  .environment-item {
    margin-top: 1rem;
    border-top: 1px solid #eee;
    padding-top: 1rem;
  }
  
  .tab-content {
    flex: 1;
    padding: 1.5rem;
    overflow: auto;
  }
  
  .section-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }
  
  .section-header h3 {
    font-size: 1.1rem;
    font-weight: 500;
  }
  
  .ioc-table {
    width: 100%;
    overflow-x: auto;
    max-width: 100%;
    overflow-x: auto;
  }
  
  .ioc-table table {
    width: 100%;
    border-collapse: collapse;
  }
  
  .ioc-table th {
    text-align: left;
    padding: 0.75rem;
    background-color: #f5f5f5;
    border-bottom: 1px solid #eee;
    font-weight: 500;
  }
  
  .ioc-table td {
    padding: 0.75rem;
    border-bottom: 1px solid #eee;
  }
  
  .danger-text {
    color: #e53935;
    font-weight: 500;
  }
  
  .danger-tag {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    background-color: #ffebee;
    color: #e53935;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
    margin-right: 0.25rem;
    margin-bottom: 0.25rem;
  }
  
  .mitre-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #f5f5f5;
    padding: 1rem;
    border-radius: 4px;
    margin-bottom: 1rem;
  }
  
  .view-details-btn {
    color: #1976d2;
    background: none;
    border: none;
    cursor: pointer;
    text-decoration: underline;
  }
  
  .high-risk-section {
    background-color: #fff8f8;
    border-radius: 4px;
    padding: 1rem;
  }
  
  .risk-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }
  
  .danger-icon {
    color: #e53935;
  }
  
  .risk-header h4 {
    color: #e53935;
    font-weight: 500;
    margin: 0;
  }
  
  .risk-content {
    padding-left: 1.5rem;
  }
  
  .risk-item {
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px dashed #ffcdd2;
  }
  
  .risk-item:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
  }
  
  .risk-title {
    font-weight: 500;
    margin-bottom: 0.5rem;
  }
  
  .risk-description {
    color: #666;
    font-size: 0.9rem;
  }
  
  .placeholder-content {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 300px;
    background-color: #f9f9f9;
    border-radius: 4px;
  }
  
  .placeholder-message {
    color: #999;
    font-size: 1.1rem;
  }
  
  .icon {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  /* 响应式调整 */
  @media (max-width: 1440px) {
    .main-content {
      padding: 1rem;
    }
  }
  
  @media (max-width: 1024px) {
    .metadata-row {
      flex-direction: column;
    }
    
    .metadata-item {
      margin-bottom: 0.5rem;
    }
    
    .file-info-container {
      flex-direction: column;
    }
    
    .file-icon-container {
      margin-right: 0;
      margin-bottom: 1.5rem;
    }
    
    .analysis-tabs {
      flex-direction: column;
    }
    
    .sidebar {
      width: 100%;
      display: flex;
      overflow-x: auto;
      padding: 0.5rem;
    }
    
    .sidebar-item, .environment-item {
      padding: 0.5rem 0.75rem;
      white-space: nowrap;
    }
    
    .sidebar-item.active {
      border-left: none;
      border-bottom: 3px solid #1976d2;
    }
    
    .environment-item {
      margin-top: 0;
      border-top: none;
      padding-top: 0.5rem;
    }
  }
  
  @media (max-width: 768px) {
    .header {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }
    
    .header-left {
      width: 100%;
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }
    
    .search-container {
      width: 100%;
    }
    
    .search-box {
      width: 100%;
    }
    
    .header-right {
      width: 100%;
      justify-content: space-between;
    }
    
    .action-buttons {
      justify-content: center;
    }
  }
  
  .engine-detection {
    padding: 1rem;
  }
  
  .detection-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }
  
  .detection-header h3 {
    font-size: 1.1rem;
    font-weight: 500;
  }
  
  .detection-summary {
    display: flex;
    gap: 1.5rem;
    color: #666;
  }
  
  .detection-ratio {
    color: #e53935;
    font-weight: 500;
  }
  
  .engine-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1rem;
  }
  
  .engine-item {
    padding: 1rem;
    background-color: #f9f9f9;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .engine-name {
    font-weight: 500;
    color: #333;
  }
  
  .engine-result {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.9rem;
    color: #666;
  }
  
  .engine-result.is-malicious {
    color: #e53935;
  }
  
  .alert-icon {
    color: #e53935;
  }
  
  .show-more {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 1rem;
    padding: 0.5rem;
    cursor: pointer;
    color: #1976d2;
  }
  
  .show-more:hover {
    background-color: #f5f5f5;
    border-radius: 4px;
  }
  
  .rotate-180 {
    transform: rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  /* 静态分析样式 */
  .static-analysis {
    padding: 1rem;
  }
  
  .analysis-section {
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }
  
  .section-title {
    font-size: 1.1rem;
    font-weight: 500;
    margin-bottom: 1rem;
    color: #333;
  }
  
  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding: 0.5rem 0;
  }
  
  .info-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.5rem;
    background: #f9f9f9;
    padding: 0.75rem;
    border-radius: 4px;
    font-size: 0.9rem;
  }
  
  .info-item {
    position: relative;
    padding: 0.5rem 0.75rem;
    background: white;
    border-radius: 4px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
  }
  
  .info-label {
    color: #666;
    white-space: nowrap;
    font-weight: 500;
    min-width: 120px;
    padding-right: 1rem;
  }
  
  .info-value {
    color: #333;
    word-break: break-all;
    flex: 1;
    font-family: monospace;
    font-size: 0.85rem;
  }
  
  .info-divider {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(to right, #e3f2fd, transparent);
  }
  
  .sections-table-container {
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid #eee;
    border-radius: 4px;
  }
  
  .sections-table {
    width: 100%;
    border-collapse: collapse;
  }
  
  .sections-table th,
  .sections-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid #eee;
  }
  
  .sections-table th {
    background: #f5f5f5;
    font-weight: 500;
    position: sticky;
    top: 0;
    z-index: 1;
  }
  
  .imports-container {
    margin-top: 1rem;
  }
  
  .imports-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border: 1px solid #eee;
    border-radius: 4px;
  }
  
  .imports-table th {
    background: #f5f5f5;
    padding: 0.75rem 1rem;
    text-align: left;
    font-weight: 500;
    border-bottom: 1px solid #eee;
  }
  
  .imports-table td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #eee;
  }
  
  .dll-name {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #1976d2;
  }
  
  .expand-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 4px;
    color: #666;
    transition: transform 0.2s;
  }
  
  .expand-btn:hover {
    background: #f5f5f5;
  }
  
  .expand-btn.expanded {
    transform: rotate(180deg);
  }
  
  .details-row {
    background: #f9f9f9;
  }
  
  .function-details {
    padding: 0 !important;
  }
  
  .function-list {
    padding: 1rem;
    max-height: 300px;
    overflow-y: auto;
  }
  
  .function-item {
    display: flex;
    gap: 1rem;
    padding: 0.5rem;
    border-bottom: 1px solid #eee;
  }
  
  .function-item:last-child {
    border-bottom: none;
  }
  
  .function-address {
    color: #666;
    font-family: monospace;
    min-width: 100px;
  }
  
  .function-name {
    font-family: monospace;
    color: #333;
  }
  
  .strings-container {
    border: 1px solid #eee;
    border-radius: 4px;
  }
  
  .strings-tabs {
    display: flex;
    border-bottom: 1px solid #eee;
  }
  
  .strings-tabs button {
    padding: 0.75rem 1.5rem;
    border: none;
    background: none;
    cursor: pointer;
    color: #666;
  }
  
  .strings-tabs button.active {
    color: #1976d2;
    border-bottom: 2px solid #1976d2;
  }
  
  .strings-content {
    max-height: 400px;
    overflow-y: auto;
    padding: 1rem;
  }
  
  .string-item {
    padding: 0.5rem;
    font-family: monospace;
    border-bottom: 1px solid #eee;
  }
  
  .string-item:last-child {
    border-bottom: none;
  }
  
  .section-header-with-icon {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    color: #1976d2;
    position: relative;
  }
  
  .section-header-with-icon .section-title {
    margin-bottom: 0;
    color: #333;
  }
  
  .section-header-with-icon .expand-icon {
    position: absolute;
    right: 0;
  }
  
  .sections-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
  }
  
  .sections-table th {
    background: #f5f5f5;
    font-weight: 500;
    position: sticky;
    top: 0;
    z-index: 1;
    padding: 1rem;
    text-align: left;
    border-bottom: 2px solid #e3f2fd;
  }
  
  .sections-table td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #eee;
  }
  
  .dll-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: #f5f5f5;
    color: #1976d2;
  }
  
  .function-divider {
    position: absolute;
    bottom: 0;
    left: 1rem;
    right: 1rem;
    height: 1px;
    background: linear-gradient(to right, #e3f2fd, transparent);
  }
  
  .import-function {
    position: relative;
    padding: 0.75rem 1rem;
  }
  
  .string-item {
    position: relative;
    padding: 0.75rem 1rem;
  }
  
  .string-divider {
    position: absolute;
    bottom: 0;
    left: 1rem;
    right: 1rem;
    height: 1px;
    background: linear-gradient(to right, #e3f2fd, transparent);
  }
  
  .strings-tabs button.active {
    color: #1976d2;
    border-bottom: 2px solid #1976d2;
    font-weight: 500;
  }
  
  .dropdown-container {
    position: relative;
    display: inline-block;
  }
  
  .dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    min-width: 160px;
    padding: 0.5rem 0;
    margin: 0.125rem 0 0;
    background-color: white;
    border: 1px solid #eee;
    border-radius: 4px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
  
  .dropdown-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    width: 100%;
    padding: 0.5rem 1rem;
    border: none;
    background: none;
    cursor: pointer;
    text-align: left;
    white-space: nowrap;
    color: #333;
  }
  
  .dropdown-item:hover {
    background-color: #f5f5f5;
  }
  
  .detection-section {
    padding: 1rem;
  }
  
  .section-header {
    margin-bottom: 1rem;
  }
  
  .section-header h3 {
    font-size: 1.1rem;
    font-weight: 500;
  }
  
  .sigma-table-container {
    overflow-x: auto;
  }
  
  .sigma-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border: 1px solid #eee;
    border-radius: 4px;
  }
  
  .sigma-table th {
    background: #f5f5f5;
    padding: 0.75rem 1rem;
    text-align: left;
    font-weight: 500;
    border-bottom: 1px solid #eee;
  }
  
  .sigma-table td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #eee;
    vertical-align: top;
  }
  
  .tags-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
  }
  
  .tag {
    background: #e3f2fd;
    color: #1976d2;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
  }
  
  .level-tag {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: 500;
  }
  
  .level-tag.critical {
    background: #ffebee;
    color: #d32f2f;
  }
  
  .level-tag.high {
    background: #fff3e0;
    color: #ef6c00;
  }
  
  .level-tag.medium {
    background: #fff8e1;
    color: #f57f17;
  }
  
  .level-tag.low {
    background: #f1f8e9;
    color: #689f38;
  }
  
  .matches-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: none;
    border: none;
    cursor: pointer;
    color: #1976d2;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
  }
  
  .matches-btn:hover {
    background: #f5f5f5;
  }
  
  .matches-row {
    background: #fafafa;
  }
  
  .matches-details {
    padding: 1rem;
  }
  
  .match-item {
    background: white;
    border: 1px solid #eee;
    border-radius: 4px;
    margin-bottom: 0.5rem;
  }
  
  .match-item:last-child {
    margin-bottom: 0;
  }
  
  .match-header {
    padding: 0.5rem 1rem;
    background: #f5f5f5;
    border-bottom: 1px solid #eee;
    font-weight: 500;
  }
  
  .match-content {
    padding: 1rem;
  }
  
  .match-field {
    margin-bottom: 0.5rem;
  }
  
  .match-field:last-child {
    margin-bottom: 0;
  }
  
  .field-label {
    color: #666;
    margin-right: 0.5rem;
  }
  
  .field-value {
    font-family: monospace;
    word-break: break-all;
  }
  
  .environment-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
  }
  
  .environment-tag {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    background: #e3f2fd;
    color: #1976d2;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
  }
  
  .yara-table-container {
    margin-bottom: 2rem;
  }
  
  .behavior-section {
    margin-bottom: 2rem;
  }
  
  .header-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .icon-danger {
    color: #d32f2f;
  }
  
  .icon-warning {
    color: #f57c00;
  }
  
  .icon-info {
    color: #1976d2;
  }
  
  .behavior-list {
    width: 100%;
    max-width: 100%;
    overflow-x: auto;
    margin-top: 1rem;
  }
  
  .behavior-item {
    background: white;
    border: 1px solid #eee;
    border-radius: 4px;
    margin-bottom: 0.5rem;
  }
  
  .behavior-item.danger {
    border-left: 4px solid #d32f2f;
  }
  
  .behavior-item.warning {
    border-left: 4px solid #f57c00;
  }
  
  .behavior-item.info {
    border-left: 4px solid #1976d2;
  }
  
  .behavior-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    cursor: pointer;
  }
  
  .behavior-header:hover {
    background: #f5f5f5;
  }
  
  .behavior-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  
  .behavior-name {
    font-weight: 500;
  }
  
  .behavior-tag {
    background: #e3f2fd;
    color: #1976d2;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
  }
  
  .attck-tag {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    background: #fff3e0;
    color: #e65100;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
  }
  
  .behavior-details {
    padding: 1rem;
    border-top: 1px solid #eee;
    background: #fafafa;
  }
  
  .attck-info {
    background: white;
    border: 1px solid #eee;
    border-radius: 4px;
    margin-bottom: 1rem;
  }
  
  .attck-header {
    padding: 0.75rem 1rem;
    font-weight: 500;
    background: #f5f5f5;
    border-bottom: 1px solid #eee;
  }
  
  .attck-content {
    padding: 1rem;
  }
  
  .attck-item {
    margin-bottom: 0.5rem;
  }
  
  .attck-item:last-child {
    margin-bottom: 0;
  }
  
  .attck-label {
    color: #666;
    margin-right: 0.5rem;
    font-weight: 500;
  }
  
  .marks-container {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .mark-item {
    background: white;
    border: 1px solid #eee;
    border-radius: 4px;
  }
  
  .mark-header {
    padding: 0.75rem 1rem;
    font-weight: 500;
    background: #f5f5f5;
    border-bottom: 1px solid #eee;
  }
  
  .mark-content {
    padding: 1rem;
  }
  
  .mark-field {
    margin-bottom: 0.5rem;
  }
  
  .mark-field:last-child {
    margin-bottom: 0;
  }
  
  .field-label {
    color: #666;
    margin-right: 0.5rem;
  }
  
  .field-value {
    font-family: monospace;
    word-break: break-all;
  }

  .tooltip-container {
  position: relative;
  display: inline-flex;
  align-items: center;
}

.tooltip {
  position: absolute;
  top: 100%;
  left: 0;  /* 改为从左侧开始 */
  transform: translateX(0);  /* 移除X轴的位移 */
  background-color: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 8px 12px;
  border-radius: 4px;
  font-size: 0.875rem;
  max-width: 1000px;  /* 调整最大宽度为合适的值 */
  white-space: normal;
  z-index: 1000;
  margin-top: 8px;
  opacity: 0;
  visibility: hidden;
  transition: all 0.2s ease;
  line-height: 1.5;  /* 添加行高 */
  text-align: left;  /* 确保文本左对齐 */
  overflow-x: auto;
}

/* 添加小箭头 */
.tooltip::before {
  content: '';
  position: absolute;
  top: -6px;
  left: 20px;  /* 改为固定位置 */
  transform: translateX(0);  /* 移除X轴的位移 */
  border-width: 0 6px 6px 6px;
  border-style: solid;
  border-color: transparent transparent rgba(0, 0, 0, 0.8) transparent;
}

/* 鼠标悬浮时显示tooltip */
.help-icon:hover ~ .tooltip {
  opacity: 1;
  visibility: visible;
}
  </style> 

<script>
export default {
  name: 'MalwareDetail'
}
</script>